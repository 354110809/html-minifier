<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
  "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title></title>
    <link rel="stylesheet" href="qunit.css" type="text/css">
    <script type="text/javascript" src="qunit.js"></script>
    <script type="text/javascript" src="../src/htmlparser.js"></script>
    <script type="text/javascript" src="../src/htmlminifier.js"></script>
  </head>
  <body>
    
    <h1 id="qunit-header">HTML Minifier</h1>
    <h2 id="qunit-banner"></h2>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>
    
    <script type="text/javascript">
      
      (function(global){
        
        var minify = global.minify;
        
        test('parsing non-trivial markup', function() {
          equals(minify('<p title="</p>">x</p>'), '<p title="</p>">x</p>');
          equals(minify('<p title=" <!-- hello world --> ">x</p>'), '<p title=" <!-- hello world --> ">x</p>');
          equals(minify('<p title=" <![CDATA[ \n\n foobar baz ]]> ">x</p>'), '<p title=" <![CDATA[ \n\n foobar baz ]]> ">x</p>');
          equals(minify('<p foo-bar=baz>xxx</p>'), '<p foo-bar="baz">xxx</p>');
          equals(minify('<p foo:bar=baz>xxx</p>'), '<p foo:bar="baz">xxx</p>');
          
          var input = '<div><div><div><div><div><div><div><div><div><div>'+
                        'i\'m 10 levels deep'+
                      '</div></div></div></div></div></div></div></div></div></div>';
                      
          equals(minify(input), input);
          
          equals(minify('<script>alert(\'<!--\')<\/script>'), '<script>alert(\'<!--\')<\/script>');
          equals(minify('<script>alert(\'<!-- foo -->\')<\/script>'), '<script>alert(\'<!-- foo -->\')<\/script>');
          equals(minify('<script>alert(\'-->\')<\/script>'), '<script>alert(\'-->\')<\/script>');
        });
        
        test('`minifiy` exists', function() {
          ok(minify);
        });
        
        test('options', function() {
          var input = '<p>blah<span>blah 2<span>blah 3</span></span></p>';
          equals(minify(input), input);
          equals(minify(input, {}), input);
        });
        
        test('case normalization', function() {
          equals(minify('<P>foo</p>'), '<p>foo</p>');
          equals(minify('<DIV>boo</DIV>'), '<div>boo</div>');
          equals(minify('<DIV title="moo">boo</DiV>'), '<div title="moo">boo</div>');
          equals(minify('<DIV TITLE="blah">boo</DIV>'), '<div title="blah">boo</div>');
          equals(minify('<DIV tItLe="blah">boo</DIV>'), '<div title="blah">boo</div>');
          equals(minify('<DiV tItLe="blah">boo</DIV>'), '<div title="blah">boo</div>');
        });
        
        test('space normalization between attributes', function() {
          equals(minify('<p title="bar">foo</p>'), '<p title="bar">foo</p>');
          equals(minify('<p title = "bar">foo</p>'), '<p title="bar">foo</p>');
          equals(minify('<p title\n\n\t  =\n     "bar">foo</p>'), '<p title="bar">foo</p>');
          equals(minify('<input title="bar"       id="boo"    value="hello world">'), '<input title="bar" id="boo" value="hello world">');
        });
        
        test('space normalization around text', function(){
          equals(minify('   <p>blah</p>\n\n\n   '), '<p>blah</p>');
        });
        
        test('doctype normalization', function() {
          var html401doctype = '<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"\n    "http://www.w3.org/TR/html4/strict.dtd">';
          var actual = minify(html401doctype, { useShortDoctype: true });
          var expected = '<!DOCTYPE html>';
          
          equals(actual, expected);
          
          equals(minify('<!DOCTYPE html>', { useShortDoctype: true }), '<!DOCTYPE html>');
          
          actual = minify(html401doctype, { useShortDoctype: false });
          expected = '<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">';
          
          equals(actual, expected);
        });
        
        test('removing comments', function(){
          var input = '<!-- test -->';
          equals(minify(input, { removeComments: true }), '');
          
          var input = '<!-- foo --><div>baz</div><!-- bar\n\n moo -->';
          equals(minify(input, { removeComments: true }), '<div>baz</div>');
          equals(minify(input, { removeComments: false }), input);
          
          var input = '<p title="<!-- comment in attribute -->">foo</p>';
          equals(minify(input, { removeComments: true }), input);
          
          var input = '<script><!-- alert(1) --><\/script>';
          equals(minify(input, { removeComments: true }), input);
          
          var input = '<STYLE><!-- alert(1) --><\/STYLE>';
          equals(minify(input, { removeComments: true }), '<style><!-- alert(1) --><\/style>');
        });
        
        test('remove comments from scripts/styles', function(){
          var input = '<script><!--alert(1)--><\/script>';
          var output = '<script>alert(1)<\/script>';
          equals(minify(input, { removeCommentsFromCDATA: true }), output);
          
          input = '<style type="text/css"><!-- p { color: red } --><\/style>';
          output = '<style type="text/css"> p { color: red } <\/style>';
          equals(minify(input, { removeCommentsFromCDATA: true }), output);
          
          input = '<script type="text/javascript">  <!-- alert("-->"); -->\n\n   <\/script>';
          output = '<script type="text/javascript"> alert("-->"); <\/script>';
          equals(minify(input, { removeCommentsFromCDATA: true }), output);
        });
        
        test('remove CDATA sections from scripts/styles', function(){
          var input = '<script>/*<![[CDATA[*/alert(1)/*]]>*/<\/script>';
          var output = '<script>alert(1)<\/script>';
          equals(minify(input, { removeCDATASectionsFromCDATA: true }), output);
          
          input = '<script>//<![[CDATA[\nalert(1)\n//]]><\/script>';
          output = '<script>\nalert(1)\n<\/script>';
          equals(minify(input, { removeCDATASectionsFromCDATA: true }), output);
          
          input = '<script type="text/javascript"> /* \n\t  <![[CDATA[  */ alert(1) /*  ]]>  */<\/script>';
          output = '<script type="text/javascript"> alert(1) <\/script>';
          equals(minify(input, { removeCDATASectionsFromCDATA: true }), output);
          
          input = '<style>/* <![[CDATA[ */p { color: red } // ]]><\/style>';
          output = '<style>p { color: red } </style>';
          equals(minify(input, { removeCDATASectionsFromCDATA: true }), output);
        });
        
        test('empty attributes', function(){
          var input = '<p id="" class="" STYLE=" " title="\n" lang="" dir="">x</p>';
          equals(minify(input, { removeEmptyAttributes: true }), '<p>x</p>');
          
          input = '<p onclick=""   ondblclick=" " onmousedown="" ONMOUSEUP="" onmouseover=" " onmousemove="" onmouseout="" '+
                  'onkeypress=\n\n  "\n     " onkeydown=\n"" onkeyup\n="">x</p>';
          equals(minify(input, { removeEmptyAttributes: true }), '<p>x</p>');
          
          input = '<input onfocus="" onblur="" onchange=" " value=" boo ">';
          equals(minify(input, { removeEmptyAttributes: true }), '<input value=" boo ">');
          
          input = '<input value="" name="foo">';
          equals(minify(input, { removeEmptyAttributes: true }), '<input name="foo">');
        });
        
        test('cleaning attributes', function(){
          var input = '<p onclick="javascript:alert(1)">x</p>';
          equals(minify(input, { cleanAttributes: true }), '<p onclick="alert(1)">x</p>');
          
          input = '<p onclick="javascript:x">x</p>';
          equals(minify(input, { cleanAttributes: true, removeAttributeQuotes: true }), '<p onclick=x>x</p>');
          
          input = '<p class=" foo bar  ">foo bar baz</p>';
          equals(minify(input, { cleanAttributes: true }), '<p class="foo bar">foo bar baz</p>');
          
          input = '<p class=" foo      ">foo bar baz</p>';
          equals(minify(input, { cleanAttributes: true }), '<p class="foo">foo bar baz</p>');
          equals(minify(input, { cleanAttributes: true, removeAttributeQuotes: true }), '<p class=foo>foo bar baz</p>');
          
          input = '<p class="\n  \n foo   \n\n\t  \t\n   ">foo bar baz</p>';
          equals(minify(input, { cleanAttributes: true }), '<p class="foo">foo bar baz</p>');
          
          input = '<p class="\n  \n foo   \n\n\t  \t\n  class1 class-23 ">foo bar baz</p>';
          equals(minify(input, { cleanAttributes: true }), '<p class="foo class1 class-23">foo bar baz</p>');
        });
        
        test('removing attribute quotes', function(){
          var input = '<p title="blah" class="a23B-foo.bar_baz:qux" id="moo">foo</p>';
          equals(minify(input, { removeAttributeQuotes: true }), '<p title=blah class=a23B-foo.bar_baz:qux id=moo>foo</p>');
          
          input = '<input value="hello world">';
          equals(minify(input, { removeAttributeQuotes: true }), '<input value="hello world">');
          
          input = '<a href="#" title="foo#bar">x</a>';
          equals(minify(input, { removeAttributeQuotes: true }), '<a href="#" title="foo#bar">x</a>');
          
          input = '<a href="http://example.com" title="blah">\nfoo\n\n</a>';
          equals(minify(input, { removeAttributeQuotes: true }), '<a href="http://example.com" title=blah>\nfoo\n\n</a>');
        });
        
        test('collapsing whitespace', function() {
          var input = '<script type="text/javascript">  \n\t   alert(1) \n\n\n  \t <\/script>', 
              output = '<script type="text/javascript">alert(1)<\/script>';
          equals(minify(input, { collapseWhitespace: true }), output);
          
          input = '<p>foo</p>    <p> bar</p>\n\n   \n\t\t  <div title="quz">baz  </div>';
          output = '<p>foo</p><p>bar</p><div title="quz">baz</div>';
          equals(minify(input, { collapseWhitespace: true }), output);
          
          input = '<p> foo    bar</p>';
          output = '<p>foo bar</p>';
          equals(minify(input, { collapseWhitespace: true }), output);
          
          input = '<p> foo    <span>  blah    22 </span> bar <img src=""></p>';
          output = '<p>foo<span>blah 22</span>bar<img src=""></p>';
          equals(minify(input, { collapseWhitespace: true }), output);
          
          input = '<textarea> foo bar     baz \n\n   x \t    y </textarea>';
          output = '<textarea> foo bar     baz \n\n   x \t    y </textarea>';
          equals(minify(input, { collapseWhitespace: true }), output);
          
          input = '<pre title="some title...">   hello     world </pre>';
          output = '<pre title="some title...">   hello     world </pre>';
          equals(minify(input, { collapseWhitespace: true }), output);
          
          input = '<script>alert("foo     bar")    <\/script>';
          output = '<script>alert("foo     bar")<\/script>';
          equals(minify(input, { collapseWhitespace: true }), output);
        });
        
        test('removing empty elements', function() {
          equals(minify('<p>x</p>', { removeEmptyElements: true }), '<p>x</p>');
          equals(minify('<p></p>', { removeEmptyElements: true }), '');
          
          var input = '<p>foo<span>bar</span><span></span></p>';
          var output = '<p>foo<span>bar</span></p>';
          equals(minify(input, { removeEmptyElements: true }), output);
          
          input = '<a href="http://example/com" title="hello world"></a>';
          output = '';
          equals(minify(input, { removeEmptyElements: true }), output);
          
          input = '<textarea cols="10" rows="10"></textarea>';
          output = '<textarea cols="10" rows="10"></textarea>';
          equals(minify(input, { removeEmptyElements: true }), output);
          
          input = '<div>hello<span>world</span></div>';
          output = '<div>hello<span>world</span></div>';
          equals(minify(input, { removeEmptyElements: true }), output);
        });
        
      })(this);
    </script>
  </body>
</html>